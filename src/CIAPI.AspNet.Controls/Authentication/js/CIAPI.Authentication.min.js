(function(a,b){a.widget("ui.CIAPI_widget_AuthenticationWidget",a.ui.CIAPI_widget,{options:{width:600,afterLogOn:function(c){},afterLogOff:function(c){},shakeOnError:false,translations:{"en-GB":{error:"Error"},"pl-PL":{error:"Błąd"}},template:a.template("defaultAuthWidgetTemplate",'<div class="ui-ciapi-authentication ui-widget ui-widget-content ui-corner-all">                                   <div class="ui-ciapi-logon-view  ui-corner-all" data-bind="visible: activeView() === \'LogOn\'">              <form class="ui-ciapi-authentication-form">    <div class="ui-ciapi-authentication-content ui-widget-content ui-corner-top">                                     <p class="ui-state-error" data-bind="text: errorMessage, visible: errorMessage().length > 0"></p>             <fieldset>                                                                                                        <label for="username">UserName</label>                                                                        <div class="ui-ciapi-authentication-input ui-corner-all ui-widget-content">                                       <input type="text"                                                                                               name="username"                                                                                               id="username"                                                                                                 class="required inputFields"                                                                                           data-bind="value: username"/>                                                                          </div>                                                                                                        <label for="password">Password</label>                                                                        <div class="ui-ciapi-authentication-input ui-corner-all ui-widget-content">                                       <input type="password"                                                                                           name="password"                                                                                               id="password"                                                                                                 class="required inputFields"                                                                                           data-bind="value: password"/>                                                                          </div>                                                                                                                                                                                                                  </fieldset>                                                                                               </div>                                                                                                        <div class="ui-ciapi-authentication-buttonpane ui-widget-content ui-helper-clearfix ui-corner-bottom">            <button class="ui-ciapi-authentication-button" data-bind="click: doLogOn">Log on</button>                 </div>       </form>                                                                                             </div>                                                                                                        <div class="ui-ciapi-logoff-view  ui-corner-all" data-bind="visible: activeView() === \'LogOff\'">                <div class="ui-ciapi-authentication-content ui-widget-content">                                                   <p>You are logged in as <span data-bind="text: username"/></p>                                            </div>                                                                                                        <div class="ui-ciapi-authentication-buttonpane ui-widget-content ui-helper-clearfix">                             <button class="ui-ciapi-authentication-button" data-bind="click: doLogOff">Log off</button>               </div>                                                                                                    </div>                                                                                                    </div>')},_createViewModel:function(c){return{widget:c,username:ko.observable(CIAPI.connection.UserName),password:ko.observable(""),activeView:ko.observable("LogOn"),errorMessage:ko.observable(""),doLogOn:function(){var d=this;
if(!d.widget.element.find(".ui-ciapi-authentication-form").valid()){return}CIAPI.connect({UserName:d.username(),Password:d.password(),success:function(e){d.widget.options.afterLogOn(CIAPI.connection);d.errorMessage("");d.widget._update()},error:function(f){var e=a.widget.localize("error")+": "+a.widget.localize(f.HttpStatus)+" ["+f.ErrorCode+"]";if(a.widget.getCurrentCulture().indexOf("en")!=-1){e+=" - "+f.ErrorMessage}d.errorMessage(e);d.widget._update()}})},doLogOff:function(){var d=this;CIAPI.disconnect({success:function(e){d.widget.options.afterLogOff(CIAPI.connection);d.widget._update()}})}}},_initCulture:function(){var c=this.options.translations;c["en-GB"]=c["en-GB"]||{};_(c["en-GB"]).defaults({error:"Error",401:"(401) Not authorized",500:"(500) Server error"});c["pl-PL"]=c["pl-PL"]||{};_(c["pl-PL"]).defaults({error:"Błąd",401:"(401) Nie dopuszczony",500:"(500) Błąd serwera"});_(this.options.translations).each(function(e,d){a.widget.addCultureInfo(d,{messages:e})});a.widget.culture(this.options.culture)},_create:function(){this._initCulture();this.options.viewModel=this._createViewModel(this);a.tmpl(this.options.template,{}).appendTo(this.element);ko.applyBindings(this.options.viewModel,this.element.get(0));this.element.css("width",this.options.width);this.element.find(".ui-ciapi-authentication-button").button({icons:{primary:"ui-icon-circle-triangle-e"}});this._update()},destroy:function(){a.Widget.prototype.destroy.call(this)},_update:function(){var c=CIAPI.connection.isConnected?"LogOff":"LogOn";this.options.viewModel.activeView(c);if(this.options.shakeOnError&&this.options.viewModel.errorMessage()){this.element.effect("shake",{times:2},100)}}})})(jQuery);

