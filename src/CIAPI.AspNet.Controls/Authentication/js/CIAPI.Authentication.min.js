(function(a,b){a.widget("ui.CIAPI_widget_AuthenticationWidget",a.ui.CIAPI_widget,{options:{width:600,afterLogOn:function(c){},afterLogOff:function(c){},shakeOnError:false,translations:{"en-GB":{error:"Error"},"pl-PL":{error:"Błąd"}},template:a.template("defaultAuthWidgetTemplate",'<div class="ui-ciapi-authentication ui-widget ui-widget-content ui-corner-all">     <div class="ui-ciapi-logon-view  ui-corner-all" data-bind="visible: activeView() === \'LogOn\'">              <form class="ui-ciapi-authentication-form">            <div class="ui-ciapi-authentication-content ui-widget-content ui-corner-top">                                     <p class="ui-state-error" data-bind="text: errorMessage, visible: errorMessage().length > 0"></p>             <fieldset>                                                                                                        <label for="username">${username}</label>                                                                     <div class="ui-ciapi-authentication-input ui-corner-all ui-widget-content">                                       <input type="text"                                                                                               name="username"                                                                                               id="username"                                                                                                 class="inputFields"                                                                                           data-bind="value: username"/>                                                                          </div>                                                                                                        <label for="password">${password}</label>                                                                     <div class="ui-ciapi-authentication-input ui-corner-all ui-widget-content">                                       <input type="password"                                                                                           name="password"                                                                                               id="password"                                                                                                 class="inputFields"                                                                                           data-bind="value: password"/>                                                                          </div>                                                                                                    </fieldset>                                                                                               </div>                                                                                                        <div class="ui-ciapi-authentication-buttonpane ui-widget-content ui-helper-clearfix ui-corner-bottom">            <button class="ui-ciapi-authentication-button" data-bind="click: doLogOn">${logon}</button>               </div>       </form>                                                                                                       </div>                                                                                                        <div class="ui-ciapi-logoff-view  ui-corner-all" data-bind="visible: activeView() === \'LogOff\'">                <div class="ui-ciapi-authentication-content ui-widget-content">                                                   <p>${you_are_logged_in_as} <span data-bind="text: username"/></p>                                         </div>                                                                                                        <div class="ui-ciapi-authentication-buttonpane ui-widget-content ui-helper-clearfix">                             <button class="ui-ciapi-authentication-button" data-bind="click: doLogOff">${logoff}</button>             </div>                                                                                                    </div>                                                                                                    </div>')},isFormValid:function(c){a.validator.messages.required="";
var d=c.widget.element.find(".ui-ciapi-authentication-form");d.validate({errorClass:"ui-state-error",rules:{username:"required",password:"required"},errorPlacement:function(e,f){},highlight:function(g,e,f){a(g).parent().addClass(e).removeClass(f)},unhighlight:function(g,e,f){a(g).parent().addClass(f).removeClass(e)}});return d.valid()},_createViewModel:function(c){var d={widget:c,username:ko.observable(CIAPI.connection.UserName),password:ko.observable(""),activeView:ko.observable("LogOn"),errorMessage:ko.observable(""),doLogOn:function(){var e=this;if(!e.widget.isFormValid(e)){return}CIAPI.connect({UserName:e.username(),Password:e.password(),success:function(f){e.widget.options.afterLogOn.call(e.widget,CIAPI.connection);e.errorMessage("");e.widget._update()},error:function(g){var f=a.widget.localize("error")+": "+a.widget.localize(g.HttpStatus)+" ["+g.ErrorCode+"]";if(a.widget.getCurrentCulture().language=="en"){f+=" - "+g.ErrorMessage}e.errorMessage(f);e.widget._update()}})},doLogOff:function(){var e=this;CIAPI.disconnect({success:function(f){e.widget.options.afterLogOff.call(e.widget,CIAPI.connection);e.widget._update()}})}};return d},replaceTokens:function(c){if(!CIAPI.connection.isConnected){console.log("Warning:  replaceTokens should not be called before authentication has happened, or not all tokens will be replaced")}return c.replace("{CIAPI.connection.UserName}",CIAPI.connection.UserName).replace("{CIAPI.connection.Session}",CIAPI.connection.Session)},_initCulture:function(){var c=this.options.translations;c["en-GB"]=c["en-GB"]||{};_(c["en-GB"]).defaults({error:"Error",401:"(401) Not authorized",500:"(500) Server error",username:"UserName",password:"Password",logon:"Log On",logoff:"Log Off",you_are_logged_in_as:"You are logged in as"});c["pl-PL"]=c["pl-PL"]||{};_(c["pl-PL"]).defaults({error:"Błąd",401:"(401) Nie dopuszczony",500:"(500) Błąd serwera",username:"Użytkownika",password:"Hasło",logon:"Zaloguj się",logoff:"Wyloguj",you_are_logged_in_as:"Jesteś zalogowany jako"});c["de-DE"]=c["de-DE"]||{};_(c["de-DE"]).defaults({error:"Fehler",401:"(401) Nicht autorisiert",500:"(500) Server-Fehler",username:"Benutzername",password:"Kennwort",logon:"Anmeldung",logoff:"Logout",you_are_logged_in_as:"Sie sind angemeldet als"});_(this.options.translations).each(function(e,d){a.widget.addCultureInfo(d,{messages:e})});a.widget.culture(this.options.culture)},_create:function(){this._initCulture();this.options.viewModel=this._createViewModel(this);a.tmpl(this.options.template,a.widget.getCurrentCulture().messages).appendTo(this.element);ko.applyBindings(this.options.viewModel,this.element.get(0));this.element.css("width",this.options.width);this.element.find(".ui-ciapi-authentication-button").button({icons:{primary:"ui-icon-circle-triangle-e"}});var c=this;var d=CIAPI.OnConnectionInvalid;CIAPI.OnConnectionInvalid=function(e){c._update.call(c.options.viewModel.widget);d()};this._update()},destroy:function(){a.Widget.prototype.destroy.call(this)},_update:function(){this.options.viewModel.activeView(CIAPI.connection.isConnected?"LogOff":"LogOn");if(this.options.shakeOnError&&this.options.viewModel.errorMessage()){this.element.effect("shake",{times:2},100)}}})})(jQuery);

